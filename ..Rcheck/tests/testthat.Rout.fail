
R version 4.3.3 (2024-02-29) -- "Angel Food Cake"
Copyright (C) 2024 The R Foundation for Statistical Computing
Platform: x86_64-pc-linux-gnu (64-bit)

R is free software and comes with ABSOLUTELY NO WARRANTY.
You are welcome to redistribute it under certain conditions.
Type 'license()' or 'licence()' for distribution details.

R is a collaborative project with many contributors.
Type 'contributors()' for more information and
'citation()' on how to cite R or R packages in publications.

Type 'demo()' for some demos, 'help()' for on-line help, or
'help.start()' for an HTML browser interface to help.
Type 'q()' to quit R.

> library(testthat)
> library(acediaR)

Attaching package: 'acediaR'

The following objects are masked from 'package:stats':

    reshape, var

> 
> test_check("acediaR") 

=== Testing vector size: 1e+05 ===
CPU multiply time: 0.000000 s
GPU multiply time: 0.004000 s
Multiply speedup:  0.00 x
Scale speedup:    0.00 x
Dot speedup:      0.25 x
⚠ GPU is slower (may be transfer-bound for this size)

=== Testing vector size: 5e+05 ===
CPU multiply time: 0.001000 s
GPU multiply time: 0.007000 s
Multiply speedup:  0.14 x
Scale speedup:    0.12 x
Dot speedup:      0.17 x
⚠ GPU is slower (may be transfer-bound for this size)

=== Testing vector size: 1e+06 ===
CPU multiply time: 0.001000 s
GPU multiply time: 0.013000 s
Multiply speedup:  0.08 x
Scale speedup:    0.08 x
Dot speedup:      0.12 x
⚠ GPU is slower (may be transfer-bound for this size)

=== Testing vector size: 2e+06 ===
CPU multiply time: 0.005000 s
GPU multiply time: 0.037000 s
Multiply speedup:  0.14 x
Scale speedup:    0.44 x
Dot speedup:      0.46 x
⚠ GPU is slower (may be transfer-bound for this size)

Parallel execution verification:
Smallest problem speedup: 0.00 x
Largest problem speedup:  0.14 x

=== GPU Tensor Parallel Execution Test ===

Testing tensor shape: 1000 x 1000 ( 1e+06 elements )
CPU time:  0.003138 s
GPU time:  0.009750 s
Speedup:   0.32 x
GPU throughput:  1.03e+08 elements/second

Testing tensor shape: 1414 x 1414 ( 1.999396e+06 elements )
CPU time:  0.013794 s
GPU time:  0.024361 s
Speedup:   0.57 x
GPU throughput:  8.21e+07 elements/second

Testing tensor shape: 1732 x 1732 ( 2.999824e+06 elements )
CPU time:  0.039439 s
GPU time:  0.036896 s
Speedup:   1.07 x
GPU throughput:  8.13e+07 elements/second

=== CUDA Parallelism Verification ===
Size: 1e+05  Time: 0.008876 s  Throughput: 1.13e+07 elem/s
Size: 2e+05  Time: 0.010783 s  Throughput: 1.85e+07 elem/s
Size: 4e+05  Time: 0.041221 s  Throughput: 9.70e+06 elem/s
Size: 8e+05  Time: 0.020457 s  Throughput: 3.91e+07 elem/s
Size: 1.6e+06  Time: 0.044962 s  Throughput: 3.56e+07 elem/s

Throughput scaling analysis:
Base throughput:   1.13e+07 elem/s
Large throughput:  3.56e+07 elem/s
Throughput ratio:  3.16 
✓ Good throughput scaling - indicates parallel execution

=== GPU Memory Efficiency Test ===
High-level functions time:  0.011000 s
Tensor operations time:     0.004000 s

Mixed operations performance:
CPU time:  0.000262 s
GPU time:  0.008804 s
Speedup:   0.03 x
✅ GPU VERIFIED: softmax input on CUDA device
✅ GPU VERIFIED: softmax result on CUDA device
✅ GPU VERIFIED: concat a on CUDA device
✅ GPU VERIFIED: concat b on CUDA device
✅ GPU VERIFIED: concat result on CUDA device
✅ GPU VERIFIED: stack result on CUDA device
✅ GPU VERIFIED: repeat on CUDA device
✅ GPU VERIFIED: pad on CUDA device

🔍 COMPREHENSIVE GPU KERNEL VERIFICATION:
✅ GPU VERIFIED: tensor creation 1 on CUDA device
✅ GPU VERIFIED: tensor creation 2 on CUDA device
✅ GPU VERIFIED: concat operation on CUDA device
✅ GPU VERIFIED: stack operation on CUDA device
✅ GPU VERIFIED: repeat operation on CUDA device
✅ GPU VERIFIED: pad operation on CUDA device
✅ GPU VERIFIED: softmax operation on CUDA device
✅ GPU VERIFIED: comparison operation on CUDA device
✅ TOTAL GPU OPERATIONS VERIFIED: 7 /7
✅ GPU SYNCHRONIZATION: All tensors synchronized successfully
🎉 CONCLUSION: All operations confirmed to use CUDA kernels!

=== ENHANCED GPU PERFORMANCE BENCHMARKS ===

>>> TESTING PROBLEM SIZE: 1e+03 ELEMENTS <<<
• Element-wise Addition: GPU: 0.0020s, CPU: 0.0000s, Speedup: 0.00x, Throughput: 0.00 GE/s
• Element-wise Multiplication: GPU: 0.0000s, CPU: 0.0000s, Speedup: NaNx, Throughput: Inf GE/s
• Scalar Multiplication: GPU: 0.0000s, CPU: 0.0000s, Speedup: NaNx, Throughput: Inf GE/s
• Sum Reduction: GPU: 0.0000s, CPU: 0.0000s, Speedup: NaNx, Throughput: Inf GE/s
• Matrix Multiplication (31x31): GPU: 0.0000s, CPU: 0.0000s, Speedup: NaNx, GFLOPS: Inf

>>> TESTING PROBLEM SIZE: 5e+03 ELEMENTS <<<
• Element-wise Addition: GPU: 0.0020s, CPU: 0.0000s, Speedup: 0.00x, Throughput: 0.00 GE/s
• Element-wise Multiplication: GPU: 0.0000s, CPU: 0.0000s, Speedup: NaNx, Throughput: Inf GE/s
• Scalar Multiplication: GPU: 0.0000s, CPU: 0.0000s, Speedup: NaNx, Throughput: Inf GE/s
• Sum Reduction: GPU: 0.0000s, CPU: 0.0000s, Speedup: NaNx, Throughput: Inf GE/s
• Matrix Multiplication (70x70): GPU: 0.0000s, CPU: 0.0000s, Speedup: NaNx, GFLOPS: Inf

>>> TESTING PROBLEM SIZE: 1e+04 ELEMENTS <<<
• Element-wise Addition: GPU: 0.0020s, CPU: 0.0000s, Speedup: 0.00x, Throughput: 0.01 GE/s
• Element-wise Multiplication: GPU: 0.0000s, CPU: 0.0000s, Speedup: NaNx, Throughput: Inf GE/s
• Scalar Multiplication: GPU: 0.0000s, CPU: 0.0000s, Speedup: NaNx, Throughput: Inf GE/s
• Sum Reduction: GPU: 0.0000s, CPU: 0.0000s, Speedup: NaNx, Throughput: Inf GE/s
• Matrix Multiplication (100x100): GPU: 0.0000s, CPU: 0.0000s, Speedup: NaNx, GFLOPS: Inf

>>> TESTING PROBLEM SIZE: 5e+04 ELEMENTS <<<
• Element-wise Addition: GPU: 0.0020s, CPU: 0.0000s, Speedup: 0.00x, Throughput: 0.03 GE/s
• Element-wise Multiplication: GPU: 0.0000s, CPU: 0.0000s, Speedup: NaNx, Throughput: Inf GE/s
• Scalar Multiplication: GPU: 0.0000s, CPU: 0.0000s, Speedup: NaNx, Throughput: Inf GE/s
• Sum Reduction: GPU: 0.0000s, CPU: 0.0000s, Speedup: NaNx, Throughput: Inf GE/s
• Matrix Multiplication (223x223): GPU: 0.0000s, CPU: 0.0000s, Speedup: NaNx, GFLOPS: Inf

>>> TESTING PROBLEM SIZE: 1e+05 ELEMENTS <<<
• Element-wise Addition: GPU: 0.0030s, CPU: 0.0000s, Speedup: 0.00x, Throughput: 0.03 GE/s
• Element-wise Multiplication: GPU: 0.0000s, CPU: 0.0000s, Speedup: NaNx, Throughput: Inf GE/s
• Scalar Multiplication: GPU: 0.0000s, CPU: 0.0000s, Speedup: NaNx, Throughput: Inf GE/s
• Sum Reduction: GPU: 0.0000s, CPU: 0.0000s, Speedup: NaNx, Throughput: Inf GE/s
• Matrix Multiplication (316x316): GPU: 0.0000s, CPU: 0.0000s, Speedup: NaNx, GFLOPS: Inf

>>> TESTING PROBLEM SIZE: 5e+05 ELEMENTS <<<
• Element-wise Addition: GPU: 0.0060s, CPU: 0.0000s, Speedup: 0.00x, Throughput: 0.08 GE/s
• Element-wise Multiplication: GPU: 0.0000s, CPU: 0.0000s, Speedup: NaNx, Throughput: Inf GE/s
• Scalar Multiplication: GPU: 0.0000s, CPU: 0.0000s, Speedup: NaNx, Throughput: Inf GE/s
• Sum Reduction: GPU: 0.0000s, CPU: 0.0010s, Speedup: Infx, Throughput: Inf GE/s
• Matrix Multiplication (707x707): GPU: 0.0000s, CPU: 0.0040s, Speedup: Infx, GFLOPS: Inf

>>> TESTING PROBLEM SIZE: 1e+06 ELEMENTS <<<
• Element-wise Addition: GPU: 0.0090s, CPU: 0.0010s, Speedup: 0.11x, Throughput: 0.11 GE/s
• Element-wise Multiplication: GPU: 0.0010s, CPU: 0.0010s, Speedup: 1.00x, Throughput: 1.00 GE/s
• Scalar Multiplication: GPU: 0.0000s, CPU: 0.0000s, Speedup: NaNx, Throughput: Inf GE/s
• Sum Reduction: GPU: 0.0000s, CPU: 0.0010s, Speedup: Infx, Throughput: Inf GE/s
• Matrix Multiplication (1000x1000): GPU: 0.0000s, CPU: 0.0040s, Speedup: Infx, GFLOPS: Inf

=== PERFORMANCE ANALYSIS SUMMARY ===
GPU Multiplication Advantage: 1e+06 elements and above
Peak Addition Throughput: 0.11 GE/s
Peak Multiplication Throughput: Inf GE/s
Estimated Memory Bandwidth (Addition): 1.33 GB/s

✓ Performance benchmark tests completed!

=== MEMORY USAGE AND SCALING VERIFICATION ===
Testing memory allocation for 1e+04 elements: Create: 0.0010s, Op: 0.0000s, Memory: 0.0 MB
Testing memory allocation for 1e+05 elements: Create: 0.0010s, Op: 0.0000s, Memory: 0.4 MB
Testing memory allocation for 5e+05 elements: Create: 0.0040s, Op: 0.0030s, Memory: 1.9 MB
Testing memory allocation for 1e+06 elements: Create: 0.0070s, Op: 0.0040s, Memory: 3.8 MB
Testing memory allocation for 2e+06 elements: Create: 0.0180s, Op: 0.0080s, Memory: 7.6 MB

✓ Memory scaling tests passed!

=== COMPREHENSIVE GPU vs CPU PERFORMANCE BENCHMARKS ===

>> Testing size: 1e+03 elements <<
Multiply: CPU= 0.000001 s, GPU= 0.003000 s, Speedup= 0.00 x
Add:      CPU= 0.000001 s, GPU= 0.003000 s, Speedup= 0.00 x
Scale:    CPU= 0.000001 s, GPU= 0.002000 s, Speedup= 0.00 x
Dot:      CPU= 0.000001 s, GPU= 0.003000 s, Speedup= 0.00 x

>> Testing size: 1e+04 elements <<
Multiply: CPU= 0.000001 s, GPU= 0.003000 s, Speedup= 0.00 x
Add:      CPU= 0.000001 s, GPU= 0.003000 s, Speedup= 0.00 x
Scale:    CPU= 0.000001 s, GPU= 0.002000 s, Speedup= 0.00 x
Dot:      CPU= 0.000001 s, GPU= 0.002000 s, Speedup= 0.00 x

>> Testing size: 5e+04 elements <<
Multiply: CPU= 0.000001 s, GPU= 0.003000 s, Speedup= 0.00 x
Add:      CPU= 0.000001 s, GPU= 0.003000 s, Speedup= 0.00 x
Scale:    CPU= 0.000001 s, GPU= 0.002000 s, Speedup= 0.00 x
Dot:      CPU= 0.000001 s, GPU= 0.003000 s, Speedup= 0.00 x

>> Testing size: 1e+05 elements <<
Multiply: CPU= 0.000001 s, GPU= 0.003000 s, Speedup= 0.00 x
Add:      CPU= 0.000001 s, GPU= 0.004000 s, Speedup= 0.00 x
Scale:    CPU= 0.000001 s, GPU= 0.002000 s, Speedup= 0.00 x
Dot:      CPU= 0.000001 s, GPU= 0.003000 s, Speedup= 0.00 x

>>> Testing large problem size: 5e+05 elements <<<
Multiply: CPU= 0.001000 s, GPU= 0.006000 s, Speedup= 0.17 x
Add:      CPU= 0.001000 s, GPU= 0.006000 s, Speedup= 0.17 x
Scale:    CPU= 0.000001 s, GPU= 0.004000 s, Speedup= 0.00 x
Dot:      CPU= 0.001000 s, GPU= 0.005000 s, Speedup= 0.20 x

>>> Testing large problem size: 1e+06 elements <<<
Multiply: CPU= 0.001000 s, GPU= 0.009000 s, Speedup= 0.11 x
Add:      CPU= 0.001000 s, GPU= 0.009000 s, Speedup= 0.11 x
Scale:    CPU= 0.001000 s, GPU= 0.007000 s, Speedup= 0.14 x
Dot:      CPU= 0.001000 s, GPU= 0.007000 s, Speedup= 0.14 x

>>> Testing large problem size: 2e+06 elements <<<
Multiply: CPU= 0.002000 s, GPU= 0.024000 s, Speedup= 0.08 x
Add:      CPU= 0.002000 s, GPU= 0.025000 s, Speedup= 0.08 x
Scale:    CPU= 0.002000 s, GPU= 0.020000 s, Speedup= 0.10 x
Dot:      CPU= 0.004000 s, GPU= 0.013000 s, Speedup= 0.31 x

=== PERFORMANCE ANALYSIS ===
Operation 'multiply': CPU faster across all test sizes (transfer overhead)
Operation 'add': CPU faster across all test sizes (transfer overhead)
Operation 'scale': CPU faster across all test sizes (transfer overhead)
Operation 'dot': CPU faster across all test sizes (transfer overhead)

Throughput scaling analysis:
Operation 'multiply': Average throughput 7.78e+07 elements/second
  ✓ High throughput suggests parallel GPU execution
Operation 'add': Average throughput 7.49e+07 elements/second
  ✓ High throughput suggests parallel GPU execution
Operation 'scale': Average throughput 1.04e+08 elements/second
  ✓ High throughput suggests parallel GPU execution
Operation 'dot': Average throughput 1.08e+08 elements/second
  ✓ High throughput suggests parallel GPU execution

=== GPU TENSOR PARALLEL SCALING TEST ===

Testing tensor shape: [ 100 x 100 ] =  1e+04  elements
CPU time:     0.000000  s
GPU time:     0.002000  s
Speedup:      0.00 x
Throughput:   5.00e+06  elem/s
Bandwidth:    0.16  GB/s

Testing tensor shape: [ 316 x 316 ] =  9.9856e+04  elements
CPU time:     0.000000  s
GPU time:     0.003000  s
Speedup:      0.00 x
Throughput:   3.33e+07  elem/s
Bandwidth:    1.07  GB/s

Testing tensor shape: [ 707 x 707 ] =  4.99849e+05  elements
CPU time:     0.002000  s
GPU time:     0.005000  s
Speedup:      0.40 x
Throughput:   1.00e+08  elem/s
Bandwidth:    3.20  GB/s

Testing tensor shape: [ 1000 x 1000 ] =  1e+06  elements
CPU time:     0.003000  s
GPU time:     0.008000  s
Speedup:      0.37 x
Throughput:   1.25e+08  elem/s
Bandwidth:    4.00  GB/s

Testing tensor shape: [ 1414 x 1414 ] =  1.999396e+06  elements
CPU time:     0.030000  s
GPU time:     0.015000  s
Speedup:      2.00 x
Throughput:   1.33e+08  elem/s
Bandwidth:    4.27  GB/s

Testing tensor shape: [ 2000 x 1000 ] =  2e+06  elements
CPU time:     0.007000  s
GPU time:     0.013000  s
Speedup:      0.54 x
Throughput:   1.54e+08  elem/s
Bandwidth:    4.92  GB/s

=== PARALLEL SCALING ANALYSIS ===
Problem size increased by:  200.0 x
GPU time increased by:      6.5 x
Throughput changed by:      30.8 x
✓ Sublinear time scaling - indicates good parallel execution
✓ Throughput maintained well across problem sizes

=== MEMORY BANDWIDTH ANALYSIS ===

Simple Add test (2e+06 elements):
CPU time:         0.001000  s
GPU time:         0.015000  s
Speedup:          0.07 x
GPU bandwidth:    3.2  GB/s
Compute rate:     1.33e+08  ops/s
⚠ Low bandwidth utilization - may indicate inefficient access patterns

Multiply test (2e+06 elements):
CPU time:         0.002000  s
GPU time:         0.015000  s
Speedup:          0.13 x
GPU bandwidth:    3.2  GB/s
Compute rate:     1.33e+08  ops/s
⚠ Low bandwidth utilization - may indicate inefficient access patterns

Fused Mult-Add test (1e+06 elements):
CPU time:         0.002000  s
GPU time:         0.019000  s
Speedup:          0.11 x
GPU bandwidth:    2.5  GB/s
Compute rate:     1.05e+08  ops/s
⚠ Low bandwidth utilization - may indicate inefficient access patterns

Complex Chain test (5e+05 elements):
CPU time:         0.002000  s
GPU time:         0.021000  s
Speedup:          0.10 x
GPU bandwidth:    2.3  GB/s
Compute rate:     9.52e+07  ops/s
⚠ Low bandwidth utilization - may indicate inefficient access patterns

=== COMPREHENSIVE TENSOR OPERATIONS TEST SUITE ===

>> Testing size: 1e+03, dtype: float <<

>> Testing size: 1e+03, dtype: double <<

>> Testing size: 1e+04, dtype: float <<

>> Testing size: 1e+04, dtype: double <<

>> Testing size: 1e+05, dtype: float <<

>> Testing size: 1e+05, dtype: double <<

=== MATRIX OPERATIONS ===
Testing matrix multiplication: 10x12 * 12x8
Testing matrix multiplication: 50x40 * 40x30
Testing matrix multiplication: 100x90 * 90x80

=== SHAPE OPERATIONS ===
Testing reshape to: 24
Testing reshape to: 6x4
Testing reshape to: 3x8
Testing reshape to: 2x3x4

=== BROADCASTING TESTS ===

=== DTYPE CONVERSION TESTS ===

=== MEMORY AND CONTIGUITY TESTS ===

✅ All comprehensive tensor tests passed! All operations verified on GPU.

=== ERROR HANDLING AND EDGE CASES ===

✓ Error handling tests passed!

=== ADVANCED TENSOR OPERATIONS ===
Testing complex slicing operations...
Testing transpose chaining...
Testing memory-efficient operations...
Testing advanced broadcasting with views...
Testing complex operation chains...
Testing mixed operations...
Testing contiguity preservation...
Testing GPU memory efficiency...
✓ Advanced tensor operations tests completed!
✅ GPU VERIFIED: parent tensor creation executed on GPU
✅ GPU VERIFIED: slice mutation executed on GPU
✅ GPU VERIFIED: 2D matrix creation executed on GPU
✅ GPU VERIFIED: 2D slice mutation executed on GPU
✅ GPU VERIFIED: matrix tensor creation executed on GPU
✅ GPU VERIFIED: transpose operation executed on GPU
✅ GPU VERIFIED: transpose + scalar executed on GPU
✅ GPU VERIFIED: 3D tensor creation executed on GPU
✅ GPU VERIFIED: permute operation executed on GPU
✅ GPU VERIFIED: permuted tensor arithmetic executed on GPU
✅ GPU VERIFIED: tensor A creation executed on GPU
✅ GPU VERIFIED: tensor B creation executed on GPU
✅ GPU VERIFIED: broadcasting addition executed on GPU
✅ GPU VERIFIED: tensor 2x3 creation executed on GPU
✅ GPU VERIFIED: tensor 2x2 creation executed on GPU
✅ GPU VERIFIED: tensor A creation executed on GPU
✅ GPU VERIFIED: tensor B creation executed on GPU
✅ GPU VERIFIED: slice extraction executed on GPU
Slice dtype: double Tensor B dtype: float 
✅ GPU VERIFIED: slice result dtype conversion executed on GPU
✅ GPU VERIFIED: broadcast addition executed on GPU
✅ GPU VERIFIED: scalar multiplication executed on GPU
✅ GPU VERIFIED: matrix A creation executed on GPU
✅ GPU VERIFIED: matrix B creation executed on GPU
✅ GPU VERIFIED: matrix multiplication executed on GPU
✅ GPU VERIFIED: matrix transpose executed on GPU

🔍 GPU VERIFICATION SUMMARY:
All operations above should show ✅ GPU VERIFIED messages.
Any ❌ GPU FALLBACK warnings indicate CPU fallback occurred.
[ FAIL 3 | WARN 0 | SKIP 0 | PASS 355 ]

══ Failed tests ════════════════════════════════════════════════════════════════
── Failure ('test-tensor-comprehensive.R:367:5'): (code run outside of `test_that()`) ──
as.array(result_chain) not equal to `expected`.
18/20 mismatches (average diff: 5.56)
[2]   7 -  3 ==  4
[3]  12 -  4 ==  8
[4]  17 -  5 == 12
[5]   3 -  6 == -3
[6]   8 -  7 ==  1
[7]  13 -  8 ==  5
[8]  18 -  9 ==  9
[9]   4 - 10 == -6
[10]  9 - 11 == -2
...
── Failure ('test-views-broadcasting.R:106:3'): Transpose view operations work on GPU ──
as.array(result) not equal to `expected`.
18/20 mismatches (average diff: 0.282)
[2]  1.60 - 1.66 == -0.0634
[3]  1.31 - 1.58 == -0.2657
[4]  1.03 - 1.81 == -0.7848
[5]  1.66 - 1.88 == -0.2208
[6]  1.29 - 1.60 == -0.3131
[7]  1.17 - 1.29 == -0.1201
[8]  1.19 - 1.31 == -0.1207
[9]  1.58 - 1.60 == -0.0224
[10] 1.31 - 1.88 == -0.5684
...
── Failure ('test-views-broadcasting.R:129:3'): Permute view operations work on GPU ──
as.array(result) not equal to `cpu_permuted`.
22/24 mismatches (average diff: 13.5)
[2]   4 - 14 == -10
[3]   6 - 26 == -20
[4]   8 - 38 == -30
[5]  10 -  4 ==   6
[6]  12 - 16 ==  -4
[7]  14 - 28 == -14
[8]  16 - 40 == -24
[9]  18 -  6 ==  12
[10] 20 - 18 ==   2
...

[ FAIL 3 | WARN 0 | SKIP 0 | PASS 355 ]
Error: Test failures
Execution halted
